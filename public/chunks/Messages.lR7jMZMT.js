import $ from"./pane.8GPi7YCA.js";import{_ as k,x as I,r as p,o as r,b as l,e as _,w as y,d as o,F as w,h as M,n as m,t as u,f as C,l as j}from"../entry/index.R2o0HwGI.js";const L={data(){return{messages:[],image:I,loading:!1}},methods:{getList(){this.loading=!0,this.$user.messages().then(t=>{console.log(t.data);let n=t.data;const a=this.groupByAndKeepLast(n);let c=[];a.forEach(e=>{let i={...e.receiver},d={...e.sender},g={userInfo:e.sender_id===this.user.id?i:d,userId:e.sender_id===this.user.id?e.receiver_id:e.sender_id,message:e.message,created_at:e.created_at};c.push(g)}),this.messages=c,console.log("chat list data:",c)}).finally(()=>{this.loading=!1})},groupByAndKeepLast(t){return Object.values(t.reduce((n,a)=>{const e=a[a.sender_id===this.user.id?"receiver_id":"sender_id"];return n[e]=a,n},{}))}},beforeMount(){this.getList()},computed:{user(){return this.$store.getters["auth/getUser"]}}},B={class:"lg:page-bg md:page-bg h-[75vh]"},K=o("span",{class:"flex justify-between items-center"},[o("h4",{class:"font-semibold"},"Chats")],-1),N=o("hr",{class:"my-3"},null,-1),A={class:"px-4 py-4"},D={class:"flex gap-4 items-center"},Y={class:""},E={class:"flex flex-col gap-5"},F=["onClick"],S={class:"flex gap-3 items-center"},U=["src"],V={class:"flex flex-col"},z={class:"text-[13px] text-black1 font-semibold"},O={class:"text-[12px] text-gray-500"},P={class:"flex flex-col items-end gap-1"},T={class:"text-gray-500 text-[11px]"},q={key:0,class:"flex justify-center"},G=o("div",{class:"text-center flex flex-col gap-2"},[o("h5",null,"No ongoing conversation")],-1),H=[G];function J(t,n,a,c,e,i){const d=p("el-skeleton-item"),g=p("el-skeleton");return r(),l("div",B,[K,N,_(g,{loading:e.loading,animated:""},{template:y(()=>[o("div",A,[o("div",D,[_(d,{variant:"image",style:{height:"40px",width:"40px","border-radius":"50%"}}),_(d,{variant:"text",style:{height:"30px",width:"80%","border-radius":"10px"}})])])]),default:y(()=>[o("div",null,[o("div",Y,[o("div",E,[(r(!0),l(w,null,M(e.messages,s=>{var h,f,x,v,b;return r(),l("div",{class:"flex items-center justify-between",onClick:Z=>t.$emit("selectMessage",s),role:"button",key:s==null?void 0:s.id},[o("div",S,[(h=s==null?void 0:s.userInfo)!=null&&h.image?(r(),l("img",{key:1,src:s!=null&&s.userInfo.image?t.imgUrl+"user/profile/"+(s==null?void 0:s.userInfo.image):e.image,class:"w-[38px] h-[38px] border-2 p-[2px] border-gray-100 rounded-full object-fit object-top"},null,8,U)):(r(),l("span",{key:0,class:m(["h-[30px] w-[30px] rounded-full flex items-center justify-center font-bold",(f=s==null?void 0:s.userInfo)==null?void 0:f.firstname.charAt(0)])},u((x=s==null?void 0:s.userInfo)==null?void 0:x.firstname.charAt(0)),3)),o("div",V,[o("span",z,u(`${(v=s==null?void 0:s.userInfo)==null?void 0:v.firstname} ${(b=s==null?void 0:s.userInfo)==null?void 0:b.lastname}`),1),o("span",O,[o("span",null,u((s==null?void 0:s.userInfo_id)!==i.user.id?"You:":""),1),C(" "+u((s==null?void 0:s.message.slice(0,12))+"..."),1)])])]),o("span",P,[o("span",T,u(t.$formatDate(s==null?void 0:s.created_at)),1)])],8,F)}),128))])]),!e.loading&&e.messages.length===0?(r(),l("div",q,H)):j("",!0)])]),_:1},8,["loading"])])}const Q=k(L,[["render",J]]),R={components:{Pane:$,Chatlist:Q},data(){return{message:{}}},methods:{selectMessage(t){this.message=t,console.log(t);function n(){return window.matchMedia("(max-width: 767px)").matches}n()?(console.log("You are using a mobile device"),this.$router.push(`/app/message/m?user=${t==null?void 0:t.userId}`)):(console.log("You are using a desktop device"),this.$router.push("/app/messages?user="+t.userId))}}},W={class:"grid md:grid-cols-3 lg:grid-cols-3 grid-cols-1 gap-4"};function X(t,n,a,c,e,i){const d=p("chatlist"),g=p("pane");return r(),l("div",null,[o("div",W,[_(d,{onSelectMessage:n[0]||(n[0]=s=>i.selectMessage(s))}),_(g,{userMessage:e.message,class:"col-span-2 lg:block md:block hidden"},null,8,["userMessage"])])])}const os=k(R,[["render",X]]);export{os as default};
