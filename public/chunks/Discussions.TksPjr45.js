import{_ as w,l as S,r as p,o as r,b as c,d as n,e as g,t as h,k as m,z as V,F as I,h as j,w as C,A as F,T as N,n as O,f as $}from"../entry/index.wkIW-Yay.js";const T={props:{messageInfo:Object,userInfo:Object,loading:Boolean},data(){return{messageData:null,userData:null,image:S,isLoading:!1}},computed:{},watch:{messageInfo:{handler(e){e?this.messageData=e:this.messageData={}},immediate:!0},userInfo:{handler(e){e?this.userData=e:this.userData={}},immediate:!0}}},J={class:"lg:px-4 py-3 md:px-4 flex justify-between items-center w-full bg-white px-5 py-[12px] border-b border-gray-300"},M={class:"flex gap-2 items-center"},U=["src"],B={class:"font-semibold"},E={class:"flex gap-2 items-center"},R=["href"],L={class:"lg:px-4 py-3 md:px-4 flex justify-between items-center w-full bg-white px-5 py-[12px]"},P={key:0,class:"flex items-end gap-2"},H=["src"],A={class:"flex flex-col"},q={class:"text-[12px] block leading-tightest"},z={class:"font-bold block leading-tightest"},G={key:1,class:"text-[12px] block leading-tightest"};function K(e,t,o,u,a,l){var s,f,i,_,x,D,y,v,k;const d=p("i-icon");return r(),c("div",null,[n("div",null,[n("div",null,[n("span",J,[n("div",M,[n("span",{role:"button",onClick:t[0]||(t[0]=b=>e.$router.go(-1))},[g(d,{icon:"ic:twotone-arrow-back"})]),n("img",{src:(s=a.userData)!=null&&s.image?e.imgUrl+"user/profile/"+((f=a.userData)==null?void 0:f.image):a.image,alt:"",class:"w-[38px] h-[38px] border-2 p-[2px] border-gray-100 rounded-full object-fit object-top"},null,8,U),n("h4",B,h(a.userData.firstname?`${(i=a.userData)==null?void 0:i.firstname} ${(_=a.userData)==null?void 0:_.lastname}`:"--- ---"),1)]),n("span",E,[n("a",{href:a.userData?`tel:${a.userData.mobile}`:"---"},[g(d,{icon:"solar:phone-bold",class:"form-icon text-gray-600",role:"button"})],8,R)])]),n("span",L,[a.messageData?(r(),c("div",P,[n("img",{src:(x=a.messageData)!=null&&x.product?e.imgUrl+"product/"+((y=(D=a.messageData)==null?void 0:D.product)==null?void 0:y.main_image):a.image,class:"w-[50px] h-[35px] p-[2px] border-gray-100 rounded-[6px] object-fit object-top"},null,8,H),n("span",A,[n("span",q,h(a.messageData.product?a.messageData.product.name:"---"),1),n("span",z,h(a.messageData.product?e.$currencyFormat(a.messageData.product.base_price):"---"),1)])])):m("",!0),a.messageData?(r(),c("span",G," Location: "+h(a.messageData.product?`${(v=a.messageData.product)==null?void 0:v.lga}, ${(k=a.messageData.product)==null?void 0:k.state}`:"---"),1)):m("",!0)])])])])}const Q=w(T,[["render",K]]),W={props:{messageData:Object},data(){return{content:"",emojiBox:!1,attachments:[],ID:this.$route.query.chatId,initialHeight:40,maxFiles:4}},methods:{addEmoji(e){let t=this.content;var o=document.getElementById("myTextarea").selectionStart;let u=e.i;this.content=t.slice(0,o)+u+t.slice(o)},resizeTextarea(e){const t=e.target;t.style.height=`${t.scrollHeight}px`},sendMessage(){let e=new FormData;e.append("message",this.content),e.append("_method","PUT"),this.attachments.length>0&&this.attachments.forEach(t=>{e.append("files[]",t)}),this.$user.sendMessage(e,this.ID).then(t=>(this.content="",this.attachments=[],this.$emit("refreshMessages"),this.$nextTick(()=>{this.scrollToEnd()}),t))},handleMessageInput(e){let t=e.target.files;const o=V();if(this.attachments.length+t.length>this.maxFiles){o.error(`Cannot select more than ${this.maxFiles} images`,{timeout:4e3});return}const u=Array.from(t);this.attachments=[...this.attachments,...u],console.log(this.attachments)},setInitialHeight(){this.$nextTick(()=>{const e=this.$el.querySelector("textarea");e.style.height=`${this.initialHeight}px`})},removePhoto(e){this.attachments.length!==0&&this.attachments.splice(e,1)},generateURL(e){let t=URL.createObjectURL(e);return setTimeout(()=>{URL.revokeObjectURL(t)},1e3),t}},mounted(){this.setInitialHeight()}},X={key:0},Y={key:0},Z={class:"grid grid-cols-4 gap-2 px-5"},ee={class:"relative"},se=["src"],te={class:"flex justify-end gap-2 absolute top-1 right-1"},ae=["onClick"],ne={class:"flex gap-4 items-center mt-4 px-5"},oe={class:"message-field bg-white border-none w-full"},le={class:"w-full flex gap-2 items-center"},re={class:"relative"},ce={class:"",role:"button"},ie={for:"message-attachment",role:"button",class:"file-label"};function ue(e,t,o,u,a,l){const d=p("i-icon"),s=p("EmojiPicker"),f=p("pxTextarea");return o.messageData.is_active&&o.messageData.product!==null?(r(),c("div",X,[a.attachments?(r(),c("div",Y,[n("div",Z,[(r(!0),c(I,null,j(a.attachments,(i,_)=>(r(),c("div",{key:_},[n("div",ee,[n("img",{src:l.generateURL(i),alt:"",class:"h-12 w-full rounded-md object-fit object-cover"},null,8,se),n("div",te,[n("span",{role:"button",class:"bg-white text-xs px-2 py-1 font-semibold rounded-md",onClick:x=>l.removePhoto(_)},[g(d,{icon:"fluent:delete-12-regular"})],8,ae)])])]))),128))])])):m("",!0),n("div",null,[n("span",ne,[n("div",oe,[n("span",le,[n("div",re,[n("span",{class:"password-iccon",role:"button",onClick:t[0]||(t[0]=i=>a.emojiBox=!a.emojiBox)},[g(d,{icon:a.emojiBox?"solar:keyboard-outline":"mingcute:emoji-line",class:"form-icon text-black2"},null,8,["icon"])]),g(N,{name:"fade"},{default:C(()=>[a.emojiBox?(r(),F(s,{key:0,class:"absolute bottom-7 left-0",native:!0,onSelect:l.addEmoji},null,8,["onSelect"])):m("",!0)]),_:1})]),g(f,{modelValue:a.content,"onUpdate:modelValue":t[1]||(t[1]=i=>a.content=i),autoResize:"",rows:"1",cols:"30"},null,8,["modelValue"]),n("div",ce,[n("input",{type:"file",multiple:"",name:"file2",id:"message-attachment",class:"hidden__input",onChange:t[2]||(t[2]=(...i)=>l.handleMessageInput&&l.handleMessageInput(...i)),ref:"file2",accept:".png,.jpg,.jpeg"},null,544),n("label",ie,[g(d,{icon:"mi:attachment",class:"form-icon text-black2"})])])])]),n("span",{class:"password-iccon bg-primary p-2 text-white rounded-full",role:"button",onClick:t[3]||(t[3]=(...i)=>l.sendMessage&&l.sendMessage(...i))},[g(d,{icon:"lets-icons:send",class:"form-icon text-2xl"})])])])])):m("",!0)}const de=w(W,[["render",ue]]),ge={props:{userData:null,messages:null,user:null},data(){return{image:S,imageView:null}},methods:{closeFullScreen(){this.imageView=null},viewImage(e){this.imageView=this.imgUrl+"messages/"+e.file_path,console.log(this.imageView)},offerFunc(e,t){let o={type:e,item:t};this.$emit("offerFunc",JSON.stringify(o))},isValidJSON(e){try{return JSON.parse(e)}catch{return!1}}}},he={class:"flex flex-col gap-3"},me=["src"],fe={key:0},_e={class:"text-[12px]"},pe={class:"flex flex-col mt-2"},xe={key:0},be={key:0,class:"flex gap-4 justify-end"},De=["onClick"],ye=["onClick"],ve={key:1,class:"text-amber-500"},ke={class:"text-xs block ml-auto"},we={key:1,class:"flex flex-col"},Ie={class:"grid grid-cols-2 gap-2 mb-2"},je=["onClick","src"],Se={class:"text-[11px] mt-1 text-gray-400 block text-right"};function Oe(e,t,o,u,a,l){const d=p("ImageFullScreen");return r(),c("div",null,[n("div",he,[(r(!0),c(I,null,j(o.messages,s=>{var f,i,_,x,D,y,v,k;return r(),c("div",{key:s==null?void 0:s.id,class:"flex items-end gap-1"},[s.user_id!==o.user.id?(r(),c("img",{key:0,src:(f=o.userData)!=null&&f.image?e.imgUrl+"user/profile/"+((i=o.userData)==null?void 0:i.image):a.image,alt:"",class:"w-[30px] h-[30px] rounded-full object-fit object-top"},null,8,me)):m("",!0),n("div",{class:O(["p-3 text-[13px] lg:w-6/12 md:w-7/12 w-9/12",[s.user_id===o.user.id?"ml-auto lg:bg-gray-100 md:bg-gray-100 bg-accent rounded-tr-[15px] rounded-bl-[15px] rounded-br-[15px]":"rounded-tr-[15px] rounded-tl-[15px] rounded- rounded-bl-[15px] bg-white"]])},[l.isValidJSON(s==null?void 0:s.message)?(r(),c("span",fe,[$(h()+" ",1),n("span",_e,h(s.user_id===o.user.id?`Offer of ${e.$currencyFormat(l.isValidJSON(s==null?void 0:s.message).amount)} for ${(_=l.isValidJSON(s==null?void 0:s.message).product)==null?void 0:_.name} sent to ${(x=o.userData)==null?void 0:x.firstname} ${(D=o.userData)==null?void 0:D.lastname}`:`Offer of ${e.$currencyFormat(l.isValidJSON(s==null?void 0:s.message).amount)} for ${(y=l.isValidJSON(s==null?void 0:s.message).product)==null?void 0:y.name} received from ${(v=o.userData)==null?void 0:v.firstname} ${(k=o.userData)==null?void 0:k.lastname}`),1),n("div",pe,[l.isValidJSON(s==null?void 0:s.message).cart.status=="0"?(r(),c("div",xe,[s.user_id!==o.user.id?(r(),c("span",be,[n("span",{class:"text-green-500",role:"button",onClick:b=>l.offerFunc("accept",s)},"Accept",8,De),n("span",{class:"text-red-500",role:"button",onClick:b=>l.offerFunc("reject",s)},"Reject",8,ye)])):(r(),c("span",ve,"Pending"))])):(r(),c("span",{key:1,class:O(["text-[12px] block",l.isValidJSON(s==null?void 0:s.message).cart.status=="1"?"text-green-500":"text-red-500"])},h(l.isValidJSON(s==null?void 0:s.message).cart.status=="1"?"Offer Accepted":"Offer Rejected"),3)),n("span",ke,h(e.$dateFormat(s==null?void 0:s.created_at)),1)])])):(r(),c("span",we,[n("div",Ie,[(r(!0),c(I,null,j(s==null?void 0:s.files,b=>(r(),c("div",{key:b.id},[n("img",{role:"button",onClick:Me=>l.viewImage(b),src:e.imgUrl+"messages/"+b.file_path,alt:"",class:"h-16 object-cover rounded-md object-center w-full"},null,8,je)]))),128))]),n("span",null,h(s==null?void 0:s.message),1),n("span",Se,h(e.$dateFormat(s==null?void 0:s.created_at)),1)]))],2)])}),128))]),a.imageView?(r(),F(d,{key:0,imgSrc:a.imageView,onCloseFullScreen:l.closeFullScreen},null,8,["imgSrc","onCloseFullScreen"])):m("",!0)])}const Fe=w(ge,[["render",Oe]]),Ve={components:{ChatHeader:Q,InputArea:de,ChatBubble:Fe},data(){return{content:"",emojiBox:!1,messages:[],userData:null,dynamicLink:"",userID:null,image:S,attachments:[],chatID:null,messageData:null,rows:1,loading:!1}},methods:{addEmoji(e){let t=this.content;var o=document.getElementById("enter-message").selectionStart;let u=e.i;this.content=t.slice(0,o)+u+t.slice(o)},getMessages(){this.ID&&(this.loading=!0,this.$user.getMessages(this.ID).then(e=>{this.messages=e.conversation.messages;let t=e.conversation;this.messageData=t;let o=t.buyer.id===this.user.id?t.seller:t.seller.id===this.user.id?t.buyer:{};this.userData=o,this.$nextTick(()=>{this.scrollToEnd()})}).finally(()=>{this.loading=!1}))},scrollToEnd(){const e=this.$refs.messagesContainer;e&&(e.scrollTop=e.scrollHeight)},isValidJSON(e){try{return JSON.parse(e)}catch{return!1}},offerFunc(e){let t=JSON.parse(e);console.log(t);let o={cat_id:this.isValidJSON(t.item.message).cart.id,id:t.item.id};this.$orders.modifyOffer(o,t.type).then(u=>{console.log(u)})}},mounted(){this.intervalId=setInterval(this.getMessages,1e4)},beforeUnmount(){clearInterval(this.intervalId)},watch:{ID:{handler(e){e&&(this.chatID=e,console.log(e),this.getMessages())},immediate:!0},"$route.query.userData":{handler(e){e&&(this.userData=JSON.parse(e))},immediate:!0}},computed:{user(){return this.$store.getters["auth/getUser"]},ID(){return this.$route.query.chatId}}},Ce={class:"lg:bg-accent md:bg-accent rounded-md flex flex-col rounded-lg md:h-full lg:h-full h-[100vh]"},Ne={key:0,class:"main-chat flex-1 overflow-y-auto p-5",ref:"messagesContainer"},$e={key:1,class:"pb-5"},Te={key:2,class:"text-center mt-4"};function Je(e,t,o,u,a,l){const d=p("chat-header"),s=p("chat-bubble"),f=p("input-area");return r(),c("div",null,[n("div",Ce,[n("div",null,[g(d,{loading:a.loading,messageInfo:a.messageData,userInfo:a.userData,class:"bg-white"},null,8,["loading","messageInfo","userInfo"])]),a.userData?(r(),c("div",Ne,[g(s,{onOfferFunc:l.offerFunc,messages:a.messages,userData:a.userData,user:l.user},null,8,["onOfferFunc","messages","userData","user"])],512)):m("",!0),l.ID&&a.messageData?(r(),c("div",$e,[g(f,{class:"",onRefreshMessages:l.getMessages,messageData:a.messageData},null,8,["onRefreshMessages","messageData"])])):m("",!0),l.ID?m("",!0):(r(),c("span",Te," Select a conversation "))])])}const Be=w(Ve,[["render",Je]]);export{Be as default};
