import{_ as j,x as B,b as a,d as t,n as D,t as d,l as w,e as u,F as I,h as M,w as E,T as A,s as C,v as K,r as v,o as l,A as L}from"../entry/index.R2o0HwGI.js";const P={components:{},props:{},data(){return{content:"",emojiBox:!1,messages:[],userData:{},dynamicLink:"",userID:null,image:B}},methods:{addEmoji(o){console.log(o);let s=this.content;var r=document.getElementById("enter-message").selectionStart;let i=o.i;this.content=s.slice(0,r)+i+s.slice(r)},getMessages(){console.log("userData:",this.userID),this.$user.getMessages(this.userID).then(o=>{console.log(o.data),this.messages=o.data,console.log(this.groupByAndKeepLast(this.messages));let s=this.groupByAndKeepLast(this.messages)[0],r={...s.receiver},i={...s.sender},e=s.sender_id===this.user.id?r:i;console.log(e),this.userData=e})},groupByAndKeepLast(o){return Object.values(o.reduce((s,r)=>{const e=r[r.sender_id===this.ID?"receiver_id":"sender_id"];return s[e]=r,s},{}))},sendMessage(){let o={receiver_id:this.ID,message:this.content};this.$user.sendMessage(o).then(s=>{console.log(s),this.getMessages(),this.content="",this.$emit("refresh")})}},mounted(){},beforeUnmount(){},watch:{ID:{handler(o){o&&(this.userID=o,console.log(o),this.getMessages())},immediate:!0}},computed:{user(){return this.$store.getters["auth/getUser"]},ID(){return this.$route.query.user}}},S={class:"lg:bg-white md:bg-white rounded-md flex flex-col"},U={class:"lg:px-4 py-3 md:px-4 flex justify-between items-center"},N={key:0,class:"flex gap-2 items-center"},O=["src"],T={class:"font-semibold"},F={class:"flex gap-2 items-center"},V=["href"],q={class:"flex flex-col justify-between lg:bg-accent md:bg-accent lg:p-4 md:p-4 h-full"},z={class:"h-[66vh] overflow-y-auto"},G={class:"flex flex-col gap-2"},H={key:0},J=t("span",null,null,-1),Q={key:1},R=t("span",null,null,-1),W={class:"flex gap-4 items-center mt-4"},X={class:"input-field bg-white border-none w-full"},Y={class:"w-full flex gap-2 items-center"},Z={class:"relative"};function $(o,s,r,i,e,c){var g,h,m,f,_,x;const p=v("i-icon"),k=v("EmojiPicker");return l(),a("div",S,[t("span",U,[Object.keys(e.userData).length>0?(l(),a("div",N,[e.userData.image?(l(),a("img",{key:1,src:(m=e.userData)!=null&&m.image?o.imgUrl+"user/profile/"+((f=e.userData)==null?void 0:f.image):e.image,alt:"",class:"w-[38px] h-[38px] border-2 p-[2px] border-gray-100 rounded-full object-fit object-top"},null,8,O)):(l(),a("span",{key:0,class:D(["h-[30px] w-[30px] flex items-center justify-center rounded-full font-bold",(g=e.userData)==null?void 0:g.firstname.charAt(0)])},d((h=e.userData)==null?void 0:h.firstname.charAt(0)),3)),t("h4",T,d(`${(_=e.userData)==null?void 0:_.firstname} ${(x=e.userData)==null?void 0:x.lastname}`),1)])):w("",!0),t("span",F,[t("a",{href:e.userData.mobile},[u(p,{icon:"ph:phone",class:"form-icon text-gray-600",role:"button"})],8,V)])]),t("div",q,[t("div",z,[t("div",G,[(l(!0),a(I,null,M(e.messages,n=>{var b,y;return l(),a("span",{class:D(["bg-white p-3 text-[13px] w-fit",[n.sender_id===c.user.id?"ml-auto bg-white rounded-tr-[15px] rounded-bl-[15px] rounded-br-[15px]":"rounded-tr-[15px] rounded-tl-[15px] rounded- rounded-bl-[15px] "]]),key:n==null?void 0:n.id},[n!=null&&n.message.title?(l(),a("span",H,[t("span",null,d(`Offer received from ${(b=e.userData)==null?void 0:b.firstname} ${(y=e.userData)==null?void 0:y.lastname}`),1),J])):(l(),a("span",Q,[t("span",null,d(n==null?void 0:n.message),1),R]))],2)}),128))])]),t("span",W,[t("div",X,[t("span",Y,[t("div",Z,[t("span",{class:"password-iccon",role:"button",onClick:s[0]||(s[0]=n=>e.emojiBox=!e.emojiBox)},[u(p,{icon:e.emojiBox?"solar:keyboard-outline":"mingcute:emoji-line",class:"form-icon text-black2"},null,8,["icon"])]),u(A,{name:"fade"},{default:E(()=>[e.emojiBox?(l(),L(k,{key:0,class:"absolute bottom-7 left-0",native:!0,onSelect:c.addEmoji},null,8,["onSelect"])):w("",!0)]),_:1})]),C(t("input",{ref:"textInput",type:"text",name:"password",class:"w-full",id:"enter-message",placeholder:"Enter Message","onUpdate:modelValue":s[1]||(s[1]=n=>e.content=n)},null,512),[[K,e.content]])])]),t("span",{class:"password-iccon bg-primary p-2 text-white rounded-full",role:"button",onClick:s[2]||(s[2]=(...n)=>c.sendMessage&&c.sendMessage(...n))},[u(p,{icon:"lets-icons:send",class:"form-icon text-2xl"})])])])])}const se=j(P,[["render",$]]);export{se as default};
