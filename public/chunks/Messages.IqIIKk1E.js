import M from"./Discussions.TksPjr45.js";import{_ as w,l as $,H as I,r as l,o as p,b as h,e as a,w as r,d as t,F as L,h as B,n as j,t as b,f as S,k as D,B as K,C as N}from"../entry/index.wkIW-Yay.js";const A={props:{allMessages:Array,isLoading:Boolean},data(){return{image:$,messages:[],loading:!1,chatId:null}},methods:{handleCommand(e){console.log("test"),I.confirm("Are you sure you want to delete this conversation. Continue?","Warning",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then(()=>{this.deleteConversation(e)}).catch(()=>{this.$toast.error("Delete operation cancelled",{timeout:4e3})})},deleteConversation(e){console.log(e,"delete"),this.$user.deleteMessage(e.id).then(s=>(console.log(s),this.$emit("refresh"),s))}},watch:{allMessages:{handler(e){this.messages=e},immediate:!0},isLoading:{handler(e){this.loading=e},immediate:!0},"$route.query":{handler(e){this.chatId=e.chatId},immediate:!0}},beforeMount(){},computed:{user(){return this.$store.getters["auth/getUser"]}}},_=e=>(K("data-v-8cd7e223"),e=e(),N(),e),R={class:"lg:bg-white md:bg-white"},T=_(()=>t("span",{class:"flex justify-between items-center"},[t("h4",{class:"font-bold text-xl px-3 pt-3"},"Chats")],-1)),U=_(()=>t("hr",{class:"mt-3"},null,-1)),z={class:"py-4 px-2"},E={class:"flex gap-4 items-center"},F={class:"py-3"},O={class:"flex flex-col"},V={class:"flex gap-3 items-center"},Y=["onClick","src"],q={class:"flex flex-col"},H=["onClick"],P={class:"flex gap-1"},W={class:"text-gray-500 text-[11px]"},G={class:"el-dropdown-link flex items-center"},J={key:0,class:"flex justify-center"},Q=_(()=>t("div",{class:"text-center flex flex-col gap-2"},[t("h5",null,"No ongoing conversation")],-1)),X=[Q];function Z(e,s,d,m,n,i){const g=l("el-skeleton-item"),u=l("i-icon"),c=l("el-dropdown-item"),y=l("el-dropdown-menu"),k=l("el-dropdown"),C=l("el-skeleton");return p(),h("div",R,[T,U,a(C,{loading:n.loading,animated:""},{template:r(()=>[t("div",z,[t("div",E,[a(g,{variant:"image",style:{height:"40px",width:"40px","border-radius":"50%"}}),a(g,{variant:"text",style:{height:"30px",width:"80%","border-radius":"10px"}})])])]),default:r(()=>[t("div",null,[t("div",F,[t("div",O,[(p(!0),h(L,null,B(n.messages,o=>{var f,x;return p(),h("div",{class:j(["flex items-center justify-between py-3 px-2",{"border-l border-l-primary border-l-2 bg-accent":(o==null?void 0:o.id)==n.chatId}]),role:"button",key:o==null?void 0:o.id},[t("div",V,[t("img",{onClick:v=>e.$emit("selectMessage",o),src:e.imgUrl+"product/"+((f=o.product)==null?void 0:f.main_image),class:"w-[38px] h-[38px] border-2 p-[2px] border-gray-100 rounded-full object-fit object-top"},null,8,Y),t("div",q,[t("span",{class:"text-[13px] text-black1 font-semibold",onClick:v=>e.$emit("selectMessage",o)},b(`${(x=o==null?void 0:o.product)==null?void 0:x.name}`),9,H)])]),t("span",P,[t("span",W,b(e.$formatShortDate(o==null?void 0:o.created_at)),1),a(k,{trigger:"click",placement:"bottom-end",onCommand:v=>i.handleCommand(o)},{dropdown:r(()=>[a(y,{class:"w-[150px]"},{default:r(()=>[a(c,{command:"deleteRecord",class:"capitalize block hover:bg-accent py-[5px] px-[8px] rounded-sm text-red-600"},{default:r(()=>[S("Delete")]),_:1})]),_:1})]),default:r(()=>[t("span",G,[a(u,{icon:"pepicons-pencil:dots-y",width:"20px"})])]),_:2},1032,["onCommand"])])],2)}),128))])]),!n.loading&&n.messages.length===0?(p(),h("div",J,X)):D("",!0)])]),_:1},8,["loading"])])}const ee=w(A,[["render",Z],["__scopeId","data-v-8cd7e223"]]),se={components:{Pane:M,Chatlist:ee},data(){return{message:{},messages:[],loading:!1}},methods:{selectMessage(e){this.message=e;function s(){return window.matchMedia("(max-width: 767px)").matches}s()?(console.log("You are using a mobile device"),this.$router.push(`/app/message/m?chatId=${e==null?void 0:e.id}`)):(console.log("You are using a desktop device"),this.$router.push("/app/messages?chatId="+e.id))},getList(e){e||(this.loading=!0),this.$user.messages().then(s=>{this.messages=s.conversations,this.$store.commit("auth/setMessagesCount",s.conversations.length)}).finally(()=>{this.loading=!1})},groupByAndKeepLast(e){return Object.values(e.reduce((s,d)=>{const n=d[d.sender_id===this.user.id?"receiver_id":"sender_id"];return s[n]=d,s},{}))}},beforeMount(){this.getList()},computed:{user(){return this.$store.getters["auth/getUser"]}}},te={class:"chat-page flex gap-4 h-[100dvh]"};function oe(e,s,d,m,n,i){const g=l("chatlist"),u=l("pane");return p(),h("div",null,[t("div",te,[a(g,{class:"lg:w-64 md:w-64 w-full border-l border-l-gray-200",isLoading:n.loading,onSelectMessage:s[0]||(s[0]=c=>i.selectMessage(c)),allMessages:n.messages,onRefresh:s[1]||(s[1]=c=>i.getList("refresh"))},null,8,["isLoading","allMessages"]),a(u,{userMessage:n.message,onRefresh:s[2]||(s[2]=c=>i.getList("refresh")),class:"lg:block md:block hidden flex-1"},null,8,["userMessage"])])])}const le=w(se,[["render",oe]]);export{le as default};
